{
  stdenv,
  bun,
}:
stdenv.mkDerivation {
  pname = "node_modules";
  src = ../.;
  version = "1.0.0";

  nativeBuildInputs = [
    bun
  ];

  dontConfigure = true;
  dontFixup = true;

  buildPhase = ''
    runHook preBuild

    export HOME=$TMPDIR
    bun install --no-progress --frozen-lockfile

    runHook postBuild
  '';

  installPhase = ''
    runHook preInstall

    mkdir -p $out/lib/node_modules
    cp -R ./node_modules/* $out/lib/node_modules

    mkdir -p $out/bin
    cp -R ./node_modules/.bin/* $out/bin

    runHook postInstall
  '';

  outputHash = "sha256-cVpHINBAMdZNd/R5bsfjWtJqkyB1A0nu0zYY8tfYqns=";
  outputHashAlgo = "sha256";
  outputHashMode = "recursive";
}
